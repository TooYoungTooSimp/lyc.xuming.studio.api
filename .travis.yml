language: csharp
mono: none
dotnet: 2.1.4
script:
  - dotnet restore
  - dotnet publish -c Release -r linux-x64 -o dist-linux
  - dotnet publish -c Release -r win-x64   -o dist-win64
  - dotnet publish -c Release -r win-x86   -o dist-win32
  - dotnet publish -c Release -r osx-x64   -o dist-osx
before_deploy:
  - export PROJ=lyc.xuming.studio.api
  - mv dist-linux $PROJ && chmod +x ./$PROJ/$PROJ && tar cJf $PROJ-linux.tar.xz $PROJ && rm -rf $PROJ
  - mv dist-win64 $PROJ && chmod +x ./$PROJ/$PROJ && tar cJf $PROJ-win64.tar.xz $PROJ && rm -rf $PROJ
  - mv dist-win32 $PROJ && chmod +x ./$PROJ/$PROJ && tar cJf $PROJ-win32.tar.xz $PROJ && rm -rf $PROJ
  - mv dist-macos $PROJ && chmod +x ./$PROJ/$PROJ && tar cJf $PROJ-macos.tar.xz $PROJ && rm -rf $PROJ
  - git tag "`TZ='Asia/Shanghai' date +'%Y%m%d%H%M%S'`.`git log --format=%h -1`"
deploy:
  provider: releases
  skip_cleanup: true
  api_key: $GITHUB_TOKEN
  file:
    - $PROJ-linux.tar.xz
    - $PROJ-win64.tar.xz
    - $PROJ-win32.tar.xz
    - $PROJ-macos.tar.xz